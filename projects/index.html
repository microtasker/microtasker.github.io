<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microclips - Short, Engaging Video Clips for Your Entertainment</title>
    <meta name="description" content="Microclips offers a collection of captivating short video clips that entertain and inspire. Discover quick, fun, and engaging videos perfect for every mood and moment.">
    <script src="https://kit.fontawesome.com/97e9dcf34a.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <!-- Firebase Firestore (for database) -->
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>

</head>

<body>
    <div class="side1">
        <div class="logo">
            <img src="" alt="">
        </div>
        <div class="nav">
            <ul>
                <li><a href="">Home</a></li>
                <li><a href="">Share</a></li>
                <li><a href="">Browse-Templates</a></li>
                <li><a href="">Subscribe</a></li>
            </ul>
        </div>
    </div>
    <div class="center">
        <div class="videos">
            <div class="contnet">
                <video >
                    
                </video>
               
            </div>
              <!-- Overlay section -->
  
          
</div>
<script>
    // Firebase configuration (replace with your own Firebase details)
    const firebaseConfig = {
        apiKey: "AIzaSyCQVUUdVNNGs89zLDJuMGa-_8wiWSJyic4",
        authDomain: "microclips-d6900.firebaseapp.com",
        projectId: "microclips-d6900",
        storageBucket: "microclips-d6900.appspot.com", // Corrected this typo
        messagingSenderId: "295362140208",
        appId: "1:295362140208:web:fa2f4b358fbeb79976b5f5"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentIndex = 0; // Track the current index of videos
    let videosData = [];  // Store all fetched video data
    let selectedVideoId = null; // Track the selected video ID from URL

    // Fetch and display videos
    async function fetchVideos() {
        const videoContainer = document.querySelector('.videos');
        try {
            const querySnapshot = await db.collection("videos").get();

            if (querySnapshot.empty) {
                videoContainer.innerHTML = 'No videos found.';
                return;
            }

            // Collect all video data in an array
            querySnapshot.forEach((doc) => {
                const videoData = doc.data();
                videoData.id = doc.id; // Assign unique video ID from Firestore document
                videosData.push(videoData);
            });

            // Get video_id from URL if present
            const urlParams = new URLSearchParams(window.location.search);
            selectedVideoId = urlParams.get('video_id'); // Get video ID from URL

            if (selectedVideoId) {
                const selectedVideo = videosData.find(video => video.id === selectedVideoId);
                if (selectedVideo) {
                    videosData = [selectedVideo, ...videosData.filter(video => video.id !== selectedVideoId)];
                }
            } else {
                shuffleArray(videosData);
            }

            // Load all videos from the fetched data (without limit)
            loadVideos(videoContainer);
        } catch (error) {
            console.error('Error fetching videos:', error);
            videoContainer.innerHTML = 'Failed to load videos. Please try again later.';
        }
    }

    function loadVideos(videoContainer) {
        videosData.forEach((videoData, index) => {
            // Create a container for each video
            const videoWrapper = document.createElement('div');
            videoWrapper.classList.add('video-container');
            videoWrapper.style.position = 'relative'; // Ensure it's positioned for overlays

            // Create a placeholder for the video (loading screen)
            const placeholder = document.createElement('div');
            placeholder.classList.add('loading-placeholder');
            placeholder.innerHTML = '<span>Loading...</span>';
            videoWrapper.appendChild(placeholder);

            // Create the video element
            const video = document.createElement('video');
            video.width = 400;
            video.controls = false; // Disable default controls to implement custom controls
            video.innerHTML = `
                <source src="${videoData.video_url}" type="video/mp4">
                Your browser does not support the video tag.
            `;
            video.style.display = 'none'; // Initially hide the video
            videoWrapper.appendChild(video);

            // Create the play/pause overlay and position it at the bottom center
            const playPauseOverlay = document.createElement('div');
            playPauseOverlay.classList.add('play-pause-overlay');
            playPauseOverlay.innerHTML = '<i class="fa-solid fa-play"></i>'; // Play icon by default
            playPauseOverlay.style.position = 'absolute';
            playPauseOverlay.style.bottom = '10px'; // Position it near the bottom
            playPauseOverlay.style.left = '50%'; // Center it horizontally
            playPauseOverlay.style.transform = 'translateX(-50%)';
            playPauseOverlay.style.display = 'none'; // Initially hidden
            videoWrapper.appendChild(playPauseOverlay);

            // Add the panel (like the share button and the overlay)
            const panel = document.createElement('div');
            panel.classList.add('panel');
            
            // Share button in the bottom right
            const shareButton = document.createElement('div');
            shareButton.classList.add('share');
            shareButton.innerHTML = '<p><i class="fa-solid fa-share"></i></p>';
            shareButton.addEventListener('click', () => {
                shareVideo(videoData.id);
            });
            videoWrapper.appendChild(shareButton);

            // Overlay section for logo, name, and caption at the bottom
            const overlay = document.createElement('div');
            overlay.classList.add('overlay');
            overlay.style.position = 'absolute';
            overlay.style.bottom = '6px';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
            overlay.style.padding = '10px';
            overlay.style.color = '#fff';

            const container = document.createElement('div');
            container.classList.add('logo-name-container'); // Add a class for styling

            // Create the logo element
            const logo = document.createElement('div');
            logo.classList.add('logo');
            logo.innerHTML = '<img src="logo23.svg" alt="microtasker">';
            container.appendChild(logo);

            // Create the name element
            const name = document.createElement('div');
            name.classList.add('name');
            name.innerHTML = '<h5>microclips</h5>';
            container.appendChild(name);

            // Append the container to the overlay
            overlay.appendChild(container);

            const caption = document.createElement('div');
            caption.classList.add('caption');
            caption.innerHTML = `<p>${videoData.title}</p>`;
            overlay.appendChild(caption);

            // Append overlay to the video wrapper
            videoWrapper.appendChild(overlay);

            // Add the video panel with the share button and overlay
            videoWrapper.appendChild(panel);

            // Handle video display and autoplay for the first video
            video.addEventListener('canplay', () => {
                video.style.display = 'block'; // Show the video when ready
                placeholder.style.display = 'none'; // Hide the placeholder

                if (currentIndex === 0 && index === 0) {
                    video.play(); // Autoplay the very first video
                    playPauseOverlay.innerHTML = '<i class="fa-solid fa-pause"></i>'; // Show Pause icon initially
                    playPauseOverlay.style.display = 'block'; // Show the overlay
                }
            });

            // Update the border (or progress) as the video plays
            video.addEventListener('timeupdate', () => {
                const progress = (video.currentTime / video.duration) * 100; // Calculate progress percentage
                video.style.borderBottom = `5px solid transparent`; // Keep the base border transparent
                video.style.borderImage = `linear-gradient(to right, red ${progress}%, transparent ${progress}%) 1`; // Animate border progress
            });

            // Reset the border on video end
            video.addEventListener('ended', () => {
                video.style.borderImage = ''; // Reset the border when the video ends
                playPauseOverlay.style.display = 'none'; // Hide the overlay after video ends
                handleVideoEnd(video); // Autoscroll to next video
            });

            // Handle video click for play/pause
            video.addEventListener('click', () => {
                if (video.paused) {
                    video.play(); // Play the video if it's paused
                    playPauseOverlay.innerHTML = '<i class="fa-solid fa-pause"></i>'; // Change overlay to Pause icon
                } else {
                    video.pause(); // Pause the video if it's playing
                    playPauseOverlay.innerHTML = '<i class="fa-solid fa-play"></i>'; // Change overlay to Play icon
                }
                playPauseOverlay.style.display = 'block'; // Show the overlay
                setTimeout(() => {
                    playPauseOverlay.style.display = 'none'; // Hide after 1 second
                }, 1000); // Hide after 1 second
            });

            // Observe and autoplay video when in view
            observeVideo(video);

            // Add the wrapper to the main video container
            videoContainer.appendChild(videoWrapper);
        });
    }

    function shareVideo(videoId) {
        // Construct the shareable URL with the video_id
        const shareUrl = window.location.origin + window.location.pathname + '?video_id=' + videoId;

        // Check if the Web Share API is supported
        if (navigator.share) {
            navigator.share({
                title: 'Check out this video!',
                url: shareUrl
            })
            .then(() => {
                console.log('Video link shared successfully');
            })
            .catch((error) => {
                console.error('Error sharing video:', error);
                alert('Sharing failed. You can manually copy the link.');
            });
        } else {
            // If Web Share API is not supported, fallback to copying the link
            const tempInput = document.createElement('input');
            tempInput.value = shareUrl;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Link copied to clipboard!');
        }
    }

    // Shuffle array to randomize the video order (except for the selected one)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function observeVideo(video) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.play(); // Play the video when in view
                } else {
                    entry.target.pause(); // Pause when out of view
                }
            });
        }, {
            threshold: 0.5 // Trigger when at least 50% of the video is visible
        });

        observer.observe(video);
    }

    function handleVideoEnd(video) {
        // After a video ends, scroll to the next video
        const nextVideoWrapper = document.querySelectorAll('.video-container')[currentIndex];
        if (nextVideoWrapper) {
            const nextVideo = nextVideoWrapper.querySelector('video');
            nextVideo.play(); // Autoplay the next video
            currentIndex++;
            nextVideoWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Scroll to the next video smoothly
        }
    }

    // Initial video fetch on page load
    window.onload = fetchVideos;
</script>








    
        
</body>

</html>